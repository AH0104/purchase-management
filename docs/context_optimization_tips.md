# コンテキスト容量最適化のヒント

## 問題
チャットのコンテキスト容量がすぐに100%近くになってしまう

## 原因
- 大量のコードファイルがコンテキストに含まれる
- 長い会話履歴が蓄積される
- 大きなファイル（特にコンポーネントやAPIルート）が複数読み込まれる

## 改善策

### 1. 引き継ぎプロンプトの活用
- **新規チャット開始時**: `docs/handover_prompt_latest.md` を参照するだけにする
- **詳細は必要に応じて**: 実際のファイルを読むのは必要な時だけ
- **プロンプトを更新**: 重要な変更があった時だけ更新

### 2. 質問の分割
- ❌ 悪い例: 「ダッシュボード、納品データ一覧、仕入先管理のすべてを実装して」
- ✅ 良い例: 「まずダッシュボード機能を実装してください。完了したら次に進みます」

### 3. ファイル読み込みの最適化
- **必要な部分だけ読む**: ファイル全体ではなく、特定の行範囲を指定
- **検索を活用**: `codebase_search`で必要な情報を探してからファイルを読む
- **大きなファイルは避ける**: 必要最小限のファイルのみ読み込む

### 4. 会話履歴の管理
- **完了したタスクの詳細は削除**: 実装が完了したら、その詳細な説明は不要
- **エラー解決後は簡潔に**: エラーが解決したら、詳細なログは削除
- **定期的に新規チャット**: 大きな機能実装が完了したら新規チャットを開始

### 5. コード参照の最適化
- **コードブロックは最小限**: 必要な部分だけを引用
- **長いコードは分割**: 複数の小さな質問に分ける
- **コメントで説明**: コード自体にコメントを追加して、説明を減らす

### 6. ドキュメントの活用
- **設計ドキュメント**: `docs/` フォルダに設計を記録
- **README更新**: 重要な変更はREADMEに記録
- **コメント追加**: コードにコメントを追加して、説明を減らす

### 7. 実装パターンの確立
- **共通パターン**: 同じパターンの実装は説明を省略
- **テンプレート化**: よく使うコードパターンをテンプレート化
- **既存コードを参考**: 既存の実装を参考にして、説明を減らす

## 推奨ワークフロー

### 新規チャット開始時
1. `docs/handover_prompt_latest.md` を参照
2. 実装したい機能を1つだけ指定
3. 必要に応じて関連ファイルを検索・参照

### 実装中
1. 小さな単位で実装・確認
2. エラーが発生したら、エラー内容だけを共有
3. 完了したら簡潔に報告

### 機能完了時
1. 実装内容を簡潔に報告
2. 次の機能に進むか、新規チャットを開始

## 例：効率的な質問

### ❌ 非効率な質問
```
ダッシュボード機能を実装してください。以下の機能を含めてください：
- 今月の仕入総額表示
- 未処理件数表示
- 仕入先別集計グラフ（棒グラフ・円グラフ）
- 直近のアップロード一覧
- ファイルアップロードへのクイックアクセスボタン
また、納品データ一覧にも以下を追加してください：
- 期間フィルタ
- 仕入先フィルタ
...
```

### ✅ 効率的な質問
```
handover_prompt_latest.mdを参照してください。

ダッシュボード機能の実装をお願いします。
優先度：高のタスク1に記載されている機能です。
```

## コンテキスト容量を確認する方法

- チャット画面の右上にコンテキスト使用率が表示される
- 80%を超えたら新規チャットを検討
- 90%を超えたら必ず新規チャットを開始

## まとめ

- **引き継ぎプロンプトを活用**: 詳細はプロンプトに任せる
- **小さく分割**: 1つの機能ずつ実装
- **必要最小限**: 必要な情報だけを読み込む
- **定期的にリセット**: 大きな機能完了後は新規チャット







